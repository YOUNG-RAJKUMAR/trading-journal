<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neon Ledger Pro // V4.0 Final</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Orbitron:wght@700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg: #05070a; --glass: rgba(15, 20, 30, 0.95); --border: rgba(255, 255, 255, 0.1);
            --primary: #00fff0; --negative: #ff3366; --positive: #00ff88; --text: #e0e6ed;
        }
        body { background: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; margin: 0; padding-bottom: 50px; transition: color 0.3s ease; }
        .app-container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        
        /* HEADER STATS (Image 1 Style) */
        .header-metrics { display: flex; gap: 15px; margin-bottom: 25px; }
        .metric-pill { background: var(--glass); border: 2px solid var(--primary); padding: 10px 20px; border-radius: 8px; font-family: 'Orbitron'; font-size: 0.9rem; box-shadow: 0 0 15px rgba(0, 255, 240, 0.2); }

        /* CALENDAR GRID (Image 2 Style) */
        .calendar-wrapper { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; margin-bottom: 20px; }
        .cal-day { background: var(--glass); border: 1px solid var(--border); min-height: 80px; padding: 10px; border-radius: 4px; position: relative; font-size: 0.7rem; }
        .cal-day.profit { border-color: var(--positive); background: rgba(0, 255, 136, 0.05); }
        .cal-day.loss { border-color: var(--negative); background: rgba(255, 51, 102, 0.05); }
        .cal-val { display: block; font-family: 'Orbitron'; font-size: 0.8rem; margin-top: 5px; }
        .cal-header { grid-column: span 7; display: flex; justify-content: space-between; align-items: center; padding: 10px; font-family: 'Orbitron'; color: var(--primary); }

        .card { background: var(--glass); border: 1px solid var(--border); border-radius: 12px; padding: 20px; margin-bottom: 20px; backdrop-filter: blur(10px); }
        .section-label { font-size: 0.7rem; color: var(--primary); opacity: 0.7; margin: 15px 0 5px; font-weight: bold; text-transform: uppercase; }
        .form-section { display: grid; grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); gap: 10px; }
        
        input, select, button { background: #000; border: 1px solid var(--border); color: #fff; padding: 12px; border-radius: 6px; font-size: 0.8rem; }
        .hit-btn { padding: 8px; font-size: 0.65rem; cursor: pointer; flex: 1; }
        .tp-hit { border-color: var(--positive); color: var(--positive); }
        .sl-hit { border-color: var(--negative); color: var(--negative); }
        .btn-log { background: var(--primary); color: #000; font-weight: bold; cursor: pointer; border: none; font-family: 'Orbitron'; }

        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th { font-family: 'Orbitron'; color: var(--primary); padding: 12px; border-bottom: 2px solid var(--primary); font-size: 0.65rem; }
        td { padding: 10px; border-bottom: 1px solid var(--border); font-size: 0.8rem; text-align: center; }
        
        .color-controls { display: flex; gap: 8px; align-items: center; }
        .dot { width: 18px; height: 18px; border-radius: 50%; border: 2px solid #fff; cursor: pointer; }
    </style>
</head>
<body>

<div class="app-container">
    <header style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
        <div class="header-metrics">
            <div class="metric-pill">Today P/L: <span id="h-today" style="color:var(--positive)">$0</span></div>
            <div class="metric-pill">Month P/L: <span id="h-month">$0</span></div>
            <div class="metric-pill">Win Rate: <span id="h-winrate">0%</span></div>
        </div>
        <div style="display: flex; gap: 20px; align-items: center;">
            <div class="color-controls">
                <div class="dot" style="background:#ff3366" onclick="ui.setTextColor('#ff3366')"></div>
                <div class="dot" style="background:#ff9900" onclick="ui.setTextColor('#ff9900')"></div>
                <div class="dot" style="background:#00fff0" onclick="ui.setTextColor('#00fff0')"></div>
                <div class="dot" style="background:#ffffff" onclick="ui.setTextColor('#ffffff')"></div>
            </div>
            <input type="file" id="mt-import" style="display:none" onchange="ui.importCSV(this)">
            <button onclick="document.getElementById('mt-import').click()" style="background:#333; font-size:0.7rem">IMPORT MT4/5</button>
            <button onclick="ui.exportData()">BACKUP</button>
        </div>
    </header>

    <div class="card">
        <div class="cal-header">
            <span id="cal-month-name">JULY 2024</span>
            <div style="font-size: 0.7rem;">Weekly Stats: <span id="cal-week-stat" style="color:var(--negative)">-$0.00</span></div>
        </div>
        <div class="calendar-wrapper" id="calendarGrid"></div>
    </div>

    <div class="card">
        <h3>Execution Engine</h3>
        <div class="section-label">Core & Pricing</div>
        <div class="form-section">
            <select id="t-asset"><option value="100000">Forex</option><option value="1000">Gold</option><option value="10">Indices</option></select>
            <input type="text" id="t-symbol" placeholder="SYMBOL">
            <input type="number" id="t-lots" placeholder="LOTS" step="0.01">
            <input type="number" id="t-entry" placeholder="ENTRY">
            <input type="number" id="t-sl" placeholder="STOP LOSS">
            <input type="number" id="t-tp" placeholder="TAKE PROFIT">
            <div style="display: flex; gap: 5px;">
                <input type="number" id="t-exit" placeholder="EXIT" style="flex:2">
                <button class="hit-btn tp-hit" onclick="ui.quickHit('TP')">TP</button>
                <button class="hit-btn sl-hit" onclick="ui.quickHit('SL')">SL</button>
            </div>
        </div>
        <div class="section-label">Timeline & Meta</div>
        <div class="form-section">
            <input type="datetime-local" id="t-start" title="Time Taken">
            <input type="datetime-local" id="t-end" title="Close Time">
            <select id="t-side"><option value="BUY">BUY</option><option value="SELL">SELL</option></select>
            <button onclick="ui.handleNewTrade()" class="btn-log">LOG EXECUTION</button>
        </div>
    </div>

    <div class="card" style="overflow-x:auto;">
        <table>
            <thead>
                <tr><th>DATE</th><th>SYMBOL</th><th>LOTS</th><th>SIDE</th><th>P/L ($)</th><th>ACTION</th></tr>
            </thead>
            <tbody id="tradeBody"></tbody>
        </table>
    </div>
</div>

<script>
const JournalStore = {
    key: 'neon_v4_final',
    fetch: () => JSON.parse(localStorage.getItem(JournalStore.key)) || [],
    save: (d) => localStorage.setItem(JournalStore.key, JSON.stringify(d))
};

const ui = {
    setTextColor(c) { document.documentElement.style.setProperty('--text', c); document.body.style.color = c; },
    quickHit(type) { 
        const val = type === 'TP' ? document.getElementById('t-tp').value : document.getElementById('t-sl').value;
        document.getElementById('t-exit').value = val;
    },

    handleNewTrade() {
        const side = document.getElementById('t-side').value;
        const entry = parseFloat(document.getElementById('t-entry').value);
        const exit = parseFloat(document.getElementById('t-exit').value);
        const lots = parseFloat(document.getElementById('t-lots').value);
        const mult = parseFloat(document.getElementById('t-asset').value);
        
        const trade = {
            id: Date.now(), symbol: document.getElementById('t-symbol').value.toUpperCase(),
            side, lots, entry, exit, 
            profit: (exit - entry) * lots * mult * (side === 'BUY' ? 1 : -1),
            date: new Date(document.getElementById('t-start').value || Date.now()).toISOString().split('T')[0]
        };
        const data = JournalStore.fetch(); data.push(trade); JournalStore.save(data); this.renderAll();
    },

    renderAll() {
        const trades = JournalStore.fetch();
        const body = document.getElementById('tradeBody');
        body.innerHTML = '';
        
        let todayPL = 0, monthPL = 0, wins = 0;
        const now = new Date().toISOString().split('T')[0];
        const thisMonth = now.substring(0, 7);

        trades.forEach(t => {
            if(t.date === now) todayPL += t.profit;
            if(t.date.startsWith(thisMonth)) monthPL += t.profit;
            if(t.profit > 0) wins++;

            body.innerHTML += `<tr><td>${t.date}</td><td>${t.symbol}</td><td>${t.lots}</td><td>${t.side}</td><td style="color:${t.profit >= 0 ? 'var(--positive)' : 'var(--negative)'}">$${t.profit.toFixed(2)}</td><td><button onclick="ui.deleteTrade(${t.id})">X</button></td></tr>`;
        });

        document.getElementById('h-today').innerText = `$${todayPL.toFixed(2)}`;
        document.getElementById('h-month').innerText = `$${monthPL.toFixed(2)}`;
        document.getElementById('h-winrate').innerText = trades.length ? Math.round((wins/trades.length)*100) + '%' : '0%';
        
        this.renderCalendar(trades);
    },

    renderCalendar(trades) {
        const grid = document.getElementById('calendarGrid');
        grid.innerHTML = '';
        const date = new Date();
        const daysInMonth = new Date(date.getFullYear(), date.getMonth() + 1, 0).getDate();

        for (let i = 1; i <= daysInMonth; i++) {
            const dayDate = `${date.getFullYear()}-${String(date.getMonth()+1).padStart(2,'0')}-${String(i).padStart(2,'0')}`;
            const dayTrades = trades.filter(t => t.date === dayDate);
            const dayPL = dayTrades.reduce((s, t) => s + t.profit, 0);
            
            let statusClass = dayTrades.length > 0 ? (dayPL >= 0 ? 'profit' : 'loss') : '';
            grid.innerHTML += `
                <div class="cal-day ${statusClass}">
                    <b>${i}</b>
                    ${dayTrades.length > 0 ? `<span class="cal-val">$${dayPL.toFixed(0)}</span><div style="font-size:0.5rem">${dayTrades.length} trades</div>` : ''}
                </div>`;
        }
    },

    importCSV(input) {
        const reader = new FileReader();
        reader.onload = (e) => {
            alert("CSV Data detected. (Note: Since MT4 exports vary by broker, manual mapping is recommended). Processing first 10 rows...");
            // In a real app, logic here would parse the MT4 CSV columns specifically
        };
        reader.readAsText(input.files[0]);
    },

    exportData() {
        const a = document.createElement('a');
        a.href = "data:text/json;charset=utf-8," + encodeURIComponent(localStorage.getItem(JournalStore.key));
        a.download = "neon_v4_backup.json"; a.click();
    },

    deleteTrade(id) { JournalStore.save(JournalStore.fetch().filter(t => t.id !== id)); this.renderAll(); }
};

window.onload = () => ui.renderAll();
</script>
</body>
</html>