<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neon Ledger Pro // V4.5 Tabbed</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Orbitron:wght@700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg: #05070a; --glass: rgba(15, 20, 30, 0.95); --border: rgba(255, 255, 255, 0.1);
            --primary: #00fff0; --negative: #ff3366; --positive: #00ff88; --text: #e0e6ed;
        }
        body { background: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; margin: 0; transition: color 0.3s ease; }
        .app-container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        
        /* HEADER METRICS */
        .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .header-metrics { display: flex; gap: 15px; }
        .metric-pill { background: var(--glass); border: 1px solid var(--primary); padding: 8px 15px; border-radius: 6px; font-family: 'Orbitron'; font-size: 0.8rem; box-shadow: 0 0 10px rgba(0, 255, 240, 0.1); }

        /* TAB NAVIGATION */
        .tab-nav { display: flex; gap: 5px; margin-bottom: 20px; border-bottom: 1px solid var(--border); }
        .tab-btn { background: transparent; border: none; color: var(--text); padding: 12px 25px; cursor: pointer; font-family: 'Orbitron'; font-size: 0.75rem; opacity: 0.5; transition: 0.3s; }
        .tab-btn.active { opacity: 1; border-bottom: 2px solid var(--primary); color: var(--primary); }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.4s ease; }

        /* CALENDAR TAB */
        .calendar-wrapper { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; }
        .cal-day { background: var(--glass); border: 1px solid var(--border); min-height: 100px; padding: 10px; border-radius: 8px; position: relative; }
        .cal-day.profit { border-color: var(--positive); background: rgba(0, 255, 136, 0.05); }
        .cal-day.loss { border-color: var(--negative); background: rgba(255, 51, 102, 0.05); }
        .cal-val { display: block; font-family: 'Orbitron'; font-size: 0.9rem; margin-top: 8px; }

        /* FORMS & TABLES */
        .card { background: var(--glass); border: 1px solid var(--border); border-radius: 12px; padding: 20px; margin-bottom: 20px; }
        .form-section { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; margin-bottom: 15px; }
        .section-label { font-size: 0.65rem; color: var(--primary); opacity: 0.7; text-transform: uppercase; font-weight: bold; margin-bottom: 8px; display: block; }
        
        input, select, button { background: #000; border: 1px solid var(--border); color: #fff; padding: 12px; border-radius: 6px; font-size: 0.8rem; }
        .hit-btn { padding: 5px; font-size: 0.6rem; cursor: pointer; flex: 1; margin-top: 4px; }
        .tp-hit { color: var(--positive); border-color: var(--positive); }
        .sl-hit { color: var(--negative); border-color: var(--negative); }
        .btn-log { background: var(--primary); color: #000; font-weight: bold; font-family: 'Orbitron'; cursor: pointer; border: none; }

        table { width: 100%; border-collapse: collapse; }
        th { font-family: 'Orbitron'; color: var(--primary); padding: 12px; border-bottom: 2px solid var(--primary); font-size: 0.65rem; text-align: center; }
        td { padding: 12px; border-bottom: 1px solid var(--border); font-size: 0.8rem; text-align: center; }

        .color-dot { width: 15px; height: 15px; border-radius: 50%; border: 1px solid #fff; cursor: pointer; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="app-container">
    <header class="header-top">
        <div class="header-metrics">
            <div class="metric-pill">Today: <span id="h-today" style="color:var(--positive)">$0</span></div>
            <div class="metric-pill">Win Rate: <span id="h-winrate">0%</span></div>
        </div>
        <div style="display:flex; gap:15px; align-items:center;">
            <div style="display:flex; gap:8px;">
                <div class="color-dot" style="background:#ff3366" onclick="ui.setColor('#ff3366')"></div>
                <div class="color-dot" style="background:#ff9900" onclick="ui.setColor('#ff9900')"></div>
                <div class="color-dot" style="background:#00fff0" onclick="ui.setColor('#00fff0')"></div>
                <div class="color-dot" style="background:#ffffff" onclick="ui.setColor('#ffffff')"></div>
            </div>
            <button onclick="ui.exportData()" style="padding:5px 10px; font-size:0.6rem">BACKUP</button>
        </div>
    </header>

    <nav class="tab-nav">
        <button class="tab-btn active" onclick="ui.switchTab('journal')">JOURNAL & EXECUTION</button>
        <button class="tab-btn" onclick="ui.switchTab('calendar')">PERFORMANCE CALENDAR</button>
        <button class="tab-btn" onclick="ui.switchTab('analytics')">ADVANCED ANALYTICS</button>
    </nav>

    <div id="tab-journal" class="tab-content active">
        <div class="card">
            <h3>Execution Engine</h3>
            <span class="section-label">Core Trade Details</span>
            <div class="form-section">
                <select id="t-asset"><option value="100000">Forex (Pips)</option><option value="1000">Gold (Points)</option><option value="10">Indices</option></select>
                <input type="text" id="t-symbol" placeholder="SYMBOL (e.g. NAS100)">
                <input type="number" id="t-lots" placeholder="LOT SIZE" step="0.01">
                <select id="t-side"><option value="BUY">BUY</option><option value="SELL">SELL</option></select>
                <select id="t-session">
                    <option value="ASIAN">Asian</option><option value="LONDON">London</option><option value="NY">New York</option>
                </select>
            </div>
            
            <span class="section-label">Pricing & Quick Fill</span>
            <div class="form-section">
                <input type="number" id="t-entry" placeholder="ENTRY">
                <input type="number" id="t-sl" placeholder="STOP LOSS">
                <input type="number" id="t-tp" placeholder="TAKE PROFIT">
                <div style="display:flex; flex-direction:column;">
                    <input type="number" id="t-exit" placeholder="EXIT PRICE">
                    <div style="display:flex; gap:5px;">
                        <button class="hit-btn tp-hit" onclick="ui.quickHit('TP')">TP Hit</button>
                        <button class="hit-btn sl-hit" onclick="ui.quickHit('SL')">SL Hit</button>
                    </div>
                </div>
            </div>

            <span class="section-label">Execution Times</span>
            <div class="form-section">
                <input type="datetime-local" id="t-start" title="Entry Time">
                <input type="datetime-local" id="t-end" title="Close Time">
                <button onclick="ui.handleNewTrade()" class="btn-log" style="grid-column: span 2;">SAVE TRADE</button>
            </div>
        </div>

        <div class="card" style="overflow-x:auto;">
            <table>
                <thead>
                    <tr><th>DATE</th><th>SYMBOL</th><th>LOTS</th><th>SIDE</th><th>P/L ($)</th><th>DUR.</th><th>ACTION</th></tr>
                </thead>
                <tbody id="tradeBody"></tbody>
            </table>
        </div>
    </div>

    <div id="tab-calendar" class="tab-content">
        <div class="card">
            <h3 id="cal-month-title">MONTHLY PERFORMANCE</h3>
            <div class="calendar-wrapper" id="calendarGrid"></div>
        </div>
    </div>

    <div id="tab-analytics" class="tab-content">
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
            <div class="card"><h3>Equity Curve</h3><canvas id="equityChart"></canvas></div>
            <div class="card"><h3>Win/Loss Ratio</h3><canvas id="pieChart"></canvas></div>
        </div>
    </div>

</div>

<script>
const JournalStore = {
    key: 'neon_v45_data',
    fetch: () => JSON.parse(localStorage.getItem(JournalStore.key)) || [],
    save: (d) => localStorage.setItem(JournalStore.key, JSON.stringify(d))
};

const ui = {
    equityChart: null, pieChart: null,

    setColor(c) { document.documentElement.style.setProperty('--text', c); document.body.style.color = c; },
    
    switchTab(tabId) {
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(`tab-${tabId}`).classList.add('active');
        event.currentTarget.classList.add('active');
        this.renderAll(); // Refresh charts/calendars on switch
    },

    quickHit(type) {
        const val = type === 'TP' ? document.getElementById('t-tp').value : document.getElementById('t-sl').value;
        document.getElementById('t-exit').value = val;
    },

    handleNewTrade() {
        const side = document.getElementById('t-side').value;
        const entry = parseFloat(document.getElementById('t-entry').value);
        const exit = parseFloat(document.getElementById('t-exit').value);
        const lots = parseFloat(document.getElementById('t-lots').value);
        const mult = parseFloat(document.getElementById('t-asset').value);
        const start = new Date(document.getElementById('t-start').value);
        const end = new Date(document.getElementById('t-end').value);

        const trade = {
            id: Date.now(), symbol: document.getElementById('t-symbol').value.toUpperCase(),
            side, lots, duration: Math.round((end - start)/60000),
            profit: (exit - entry) * lots * mult * (side === 'BUY' ? 1 : -1),
            date: new Date(document.getElementById('t-start').value || Date.now()).toISOString().split('T')[0]
        };
        const data = JournalStore.fetch(); data.push(trade); JournalStore.save(data); this.renderAll();
    },

    renderAll() {
        const trades = JournalStore.fetch();
        const body = document.getElementById('tradeBody'); body.innerHTML = '';
        let todayPL = 0, wins = 0, cumulative = [], equity = 0;
        const now = new Date().toISOString().split('T')[0];

        trades.forEach(t => {
            equity += t.profit; cumulative.push(equity);
            if(t.date === now) todayPL += t.profit;
            if(t.profit > 0) wins++;
            body.innerHTML += `<tr><td>${t.date}</td><td>${t.symbol}</td><td>${t.lots}</td><td>${t.side}</td><td style="color:${t.profit >= 0 ? 'var(--positive)' : 'var(--negative)'}">$${t.profit.toFixed(2)}</td><td>${t.duration}m</td><td><button onclick="ui.deleteTrade(${t.id})">X</button></td></tr>`;
        });

        document.getElementById('h-today').innerText = `$${todayPL.toFixed(2)}`;
        document.getElementById('h-winrate').innerText = trades.length ? Math.round((wins/trades.length)*100) + '%' : '0%';
        
        this.renderCalendar(trades);
        this.updateCharts(cumulative, trades.map(t => t.date), wins, trades.length - wins);
    },

    renderCalendar(trades) {
        const grid = document.getElementById('calendarGrid'); grid.innerHTML = '';
        const d = new Date();
        const days = new Date(d.getFullYear(), d.getMonth() + 1, 0).getDate();
        for (let i = 1; i <= days; i++) {
            const dateStr = `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(i).padStart(2,'0')}`;
            const dayTrades = trades.filter(t => t.date === dateStr);
            const dayPL = dayTrades.reduce((s, t) => s + t.profit, 0);
            const status = dayTrades.length > 0 ? (dayPL >= 0 ? 'profit' : 'loss') : '';
            grid.innerHTML += `<div class="cal-day ${status}"><b>${i}</b>${dayTrades.length > 0 ? `<span class="cal-val">$${dayPL.toFixed(0)}</span>` : ''}</div>`;
        }
    },

    updateCharts(eq, labels, wins, losses) {
        if(this.equityChart) this.equityChart.destroy();
        this.equityChart = new Chart(document.getElementById('equityChart'), {
            type: 'line', data: { labels, datasets: [{ label: 'Equity', data: eq, borderColor: '#00fff0', fill: true, backgroundColor: 'rgba(0,255,240,0.05)' }] }
        });
        if(this.pieChart) this.pieChart.destroy();
        this.pieChart = new Chart(document.getElementById('pieChart'), {
            type: 'doughnut', data: { labels: ['Wins', 'Losses'], datasets: [{ data: [wins, losses], backgroundColor: ['#00ff88', '#ff3366'], borderWidth: 0 }] }
        });
    },

    exportData() {
        const a = document.createElement('a'); a.href = "data:text/json;charset=utf-8," + encodeURIComponent(localStorage.getItem(JournalStore.key));
        a.download = "neon_ledger_v45.json"; a.click();
    },

    deleteTrade(id) { JournalStore.save(JournalStore.fetch().filter(t => t.id !== id)); this.renderAll(); }
};

window.onload = () => ui.renderAll();
</script>
</body>
</html>