<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ledger // Black Minimalist</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            /* True black and stark grays */
            --bg: #000000; 
            --surface: #0a0a0a; 
            --border: #222222;
            --primary: #ffffff; 
            --negative: #ff4444; 
            --positive: #44ff88; 
            --text: #cccccc;
            --text-light: #ffffff;
        }
        body { 
            background: var(--bg); 
            color: var(--text); 
            font-family: 'Inter', sans-serif; 
            margin: 0; 
            -webkit-font-smoothing: antialiased;
        }
        .app-container { max-width: 1400px; margin: 0 auto; padding: 40px 20px; }
        
        /* HEADER */
        .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px; border-bottom: 1px solid var(--border); padding-bottom: 20px; }
        .header-title { font-weight: 300; font-size: 1.5rem; color: var(--text-light); letter-spacing: 2px; text-transform: uppercase; margin: 0; }

        /* TABS */
        .tab-nav { display: flex; gap: 20px; margin-bottom: 30px; }
        .tab-btn { background: transparent; border: none; color: var(--text); padding: 0 0 10px 0; cursor: pointer; font-size: 0.85rem; font-weight: 600; letter-spacing: 1px; text-transform: uppercase; opacity: 0.5; transition: all 0.2s; }
        .tab-btn:hover { opacity: 0.8; }
        .tab-btn.active { opacity: 1; border-bottom: 2px solid var(--primary); color: var(--text-light); }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.4s ease; }

        /* ANALYTICS GRID */
        .analytics-dashboard { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1px; background: var(--border); border: 1px solid var(--border); margin-bottom: 30px; }
        .stat-card { background: var(--surface); padding: 25px 20px; text-align: left; }
        .stat-label { font-size: 0.7rem; color: #888; text-transform: uppercase; letter-spacing: 1px; }
        .stat-val { display: block; font-weight: 300; font-size: 1.8rem; margin-top: 8px; color: var(--text-light); }

        /* CALENDAR */
        .calendar-controls { display: flex; gap: 10px; margin-bottom: 20px; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; background: var(--border); border: 1px solid var(--border); }
        .cal-day { background: var(--surface); min-height: 100px; padding: 12px; }
        .cal-day b { font-weight: 400; font-size: 0.85rem; color: #666; }
        .cal-day.profit { border-left: 2px solid var(--positive); }
        .cal-day.loss { border-left: 2px solid var(--negative); }

        /* FORM & CARDS */
        .card { background: var(--surface); border: 1px solid var(--border); padding: 30px; margin-bottom: 30px; }
        .card h3 { margin-top: 0; font-weight: 400; font-size: 1rem; color: var(--text-light); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 20px; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; }
        .section-label { font-size: 0.7rem; color: #888; text-transform: uppercase; margin: 25px 0 10px; display: block; letter-spacing: 1px; }
        .section-label:first-child { margin-top: 0; }
        
        input, select, button { background: var(--bg); border: 1px solid var(--border); color: var(--text-light); padding: 12px 15px; font-size: 0.85rem; font-family: 'Inter', sans-serif; outline: none; transition: border-color 0.2s; }
        input:focus, select:focus { border-color: #555; }
        button { cursor: pointer; text-transform: uppercase; letter-spacing: 1px; font-weight: 600; }
        button:hover { background: #111; }
        
        .hit-btn { padding: 8px; font-size: 0.65rem; flex: 1; margin-top: 5px; background: var(--surface); }
        .tp-hit { border-color: var(--positive); color: var(--positive); }
        .sl-hit { border-color: var(--negative); color: var(--negative); }
        .tp-hit:hover { background: var(--positive); color: var(--bg); }
        .sl-hit:hover { background: var(--negative); color: var(--bg); }

        .save-btn { background: var(--text-light); color: var(--bg); grid-column: span 2; border: none; margin-top: 5px; }
        .save-btn:hover { background: #ddd; }

        /* TABLE */
        table { width: 100%; border-collapse: collapse; text-align: left; }
        th { color: #888; padding: 15px 10px; border-bottom: 1px solid var(--border); font-size: 0.7rem; text-transform: uppercase; letter-spacing: 1px; font-weight: 400; }
        td { padding: 15px 10px; border-bottom: 1px solid var(--border); font-size: 0.85rem; color: var(--text-light); }
        td button { background: transparent; border: 1px solid var(--border); padding: 5px 10px; font-size: 0.7rem; color: #888; }
        td button:hover { border-color: var(--negative); color: var(--negative); }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="app-container">
    <header class="header-top">
        <h1 class="header-title">Ledger // Minimal</h1>
    </header>

    <nav class="tab-nav">
        <button class="tab-btn active" onclick="ui.switchTab('journal')">Journal Entries</button>
        <button class="tab-btn" onclick="ui.switchTab('calendar')">Performance Calendar</button>
        <button class="tab-btn" onclick="ui.switchTab('analytics')">Data Analytics</button>
    </nav>

    <div id="tab-journal" class="tab-content active">
        <div class="card">
            <span class="section-label">Execution Data</span>
            <div class="form-grid">
                <select id="t-asset"><option value="100000">Forex</option><option value="1000">Gold</option><option value="10">Indices</option></select>
                <input type="text" id="t-symbol" placeholder="Symbol">
                <input type="number" id="t-lots" placeholder="Lot Size" step="0.01">
                <select id="t-side"><option value="BUY">Long (Buy)</option><option value="SELL">Short (Sell)</option></select>
                <select id="t-session">
                    <option value="ASIAN">Asian Session</option>
                    <option value="LONDON">London Session</option>
                    <option value="NY">NY Session</option>
                </select>
            </div>

            <span class="section-label">Pricing Parameters</span>
            <div class="form-grid">
                <input type="number" id="t-entry" placeholder="Entry Price">
                <input type="number" id="t-sl" placeholder="Stop Loss">
                <input type="number" id="t-tp" placeholder="Take Profit">
                <div style="display:flex; flex-direction:column;">
                    <input type="number" id="t-exit" placeholder="Exit Price">
                    <div style="display:flex; gap:5px;">
                        <button class="hit-btn tp-hit" onclick="ui.quickHit('TP')">TP Hit</button>
                        <button class="hit-btn sl-hit" onclick="ui.quickHit('SL')">SL Hit</button>
                    </div>
                </div>
            </div>

            <span class="section-label">Duration & Logging</span>
            <div class="form-grid">
                <input type="datetime-local" id="t-start" title="Time Taken">
                <input type="datetime-local" id="t-end" title="Close Time">
                <button onclick="ui.handleNewTrade()" class="save-btn">Record Execution</button>
            </div>
        </div>

        <div class="card" style="overflow-x:auto; padding: 0 20px;">
            <table>
                <thead>
                    <tr><th>Date</th><th>Asset</th><th>Lots</th><th>Side</th><th>Session</th><th>P/L ($)</th><th>Dur.</th><th>Remove</th></tr>
                </thead>
                <tbody id="tradeBody"></tbody>
            </table>
        </div>
    </div>

    <div id="tab-calendar" class="tab-content">
        <div class="calendar-controls">
            <select id="cal-month" onchange="ui.renderCalendar()"></select>
            <select id="cal-year" onchange="ui.renderCalendar()"></select>
        </div>
        <div class="calendar-grid" id="calendarGrid"></div>
    </div>

    <div id="tab-analytics" class="tab-content">
        <div class="analytics-dashboard">
            <div class="stat-card"><span class="stat-label">Profit Factor</span><span id="s-pf" class="stat-val">0.00</span></div>
            <div class="stat-card"><span class="stat-label">Gross Profit</span><span id="s-gp" class="stat-val" style="color:var(--positive)">$0</span></div>
            <div class="stat-card"><span class="stat-label">Gross Loss</span><span id="s-gl" class="stat-val" style="color:var(--negative)">$0</span></div>
            <div class="stat-card"><span class="stat-label">Avg Win / Loss</span><span id="s-awl" class="stat-val">$0 / $0</span></div>
            <div class="stat-card"><span class="stat-label">Avg R:R</span><span id="s-arr" class="stat-val">1:0.0</span></div>
            <div class="stat-card"><span class="stat-label">Avg Duration</span><span id="s-adur" class="stat-val">0m</span></div>
        </div>
        
        <div style="display:grid; grid-template-columns: 2fr 1fr; gap:30px;">
            <div class="card"><h3>Equity Curve</h3><canvas id="equityChart"></canvas></div>
            <div class="card">
                <h3>Profit/Loss Ratio</h3>
                <canvas id="pieChart"></canvas>
                
                <hr style="border: 0; border-top: 1px solid var(--border); margin: 30px 0 20px;">
                
                <div class="stat-label">Top Performing Asset</div>
                <div id="s-best-inst" class="stat-val" style="color:var(--text-light); font-size:1.1rem; margin-top: 5px; margin-bottom: 20px;">---</div>

                <div class="stat-label">Best Session (P/L & Ratio)</div>
                <div id="s-best-session" class="stat-val" style="color:var(--positive); font-size:1.1rem; margin-top: 5px; margin-bottom: 20px;">---</div>

                <div class="stat-label">Worst Session (P/L & Ratio)</div>
                <div id="s-worst-session" class="stat-val" style="color:var(--negative); font-size:1.1rem; margin-top: 5px;">---</div>
            </div>
        </div>
    </div>
</div>

<script>
const JournalStore = {
    key: 'ledger_v6_minimal',
    fetch: () => JSON.parse(localStorage.getItem(JournalStore.key)) || [],
    save: (d) => localStorage.setItem(JournalStore.key, JSON.stringify(d))
};

const ui = {
    charts: {},
    
    init() {
        const months = ["January","February","March","April","May","June","July","August","September","October","November","December"];
        const monthSel = document.getElementById('cal-month');
        const yearSel = document.getElementById('cal-year');
        months.forEach((m, i) => monthSel.innerHTML += `<option value="${i}" ${i === new Date().getMonth() ? 'selected' : ''}>${m}</option>`);
        for(let y=2024; y<=2026; y++) yearSel.innerHTML += `<option value="${y}" ${y === new Date().getFullYear() ? 'selected' : ''}>${y}</option>`;
        
        Chart.defaults.color = '#888';
        Chart.defaults.font.family = "'Inter', sans-serif";
        
        this.renderAll();
    },
    
    switchTab(id) {
        document.querySelectorAll('.tab-content, .tab-btn').forEach(el => el.classList.remove('active'));
        document.getElementById(`tab-${id}`).classList.add('active');
        event.currentTarget.classList.add('active');
        this.renderAll();
    },

    quickHit(type) {
        const val = type === 'TP' ? document.getElementById('t-tp').value : document.getElementById('t-sl').value;
        document.getElementById('t-exit').value = val;
    },

    handleNewTrade() {
        const side = document.getElementById('t-side').value;
        const entry = parseFloat(document.getElementById('t-entry').value);
        const exit = parseFloat(document.getElementById('t-exit').value);
        const lots = parseFloat(document.getElementById('t-lots').value);
        const mult = parseFloat(document.getElementById('t-asset').value);
        const start = new Date(document.getElementById('t-start').value);
        const end = new Date(document.getElementById('t-end').value);
        const riskVal = Math.abs(entry - (parseFloat(document.getElementById('t-sl').value) || entry)) * lots * mult;

        if(!entry || !exit || !lots) return alert("Please fill required numerical fields.");

        const trade = {
            id: Date.now(), symbol: document.getElementById('t-symbol').value.toUpperCase() || 'UNKN',
            side, lots, session: document.getElementById('t-session').value,
            duration: Math.round((end - start)/60000) || 0, risk: riskVal,
            profit: (exit - entry) * lots * mult * (side === 'BUY' ? 1 : -1),
            date: new Date(document.getElementById('t-start').value || Date.now()).toISOString().split('T')[0]
        };
        const data = JournalStore.fetch(); data.push(trade); JournalStore.save(data); this.renderAll();
    },

    renderAll() {
        const trades = JournalStore.fetch();
        const body = document.getElementById('tradeBody'); body.innerHTML = '';
        
        let gProf = 0, gLoss = 0, winCount = 0, lossCount = 0, totalRR = 0, totalDur = 0, cumulative = [], eq = 0;
        let instMap = {};
        let sessionStats = {};

        trades.forEach(t => {
            eq += t.profit; cumulative.push(eq);
            totalDur += t.duration;
            if(t.profit > 0) { gProf += t.profit; winCount++; } else { gLoss += Math.abs(t.profit); lossCount++; }
            totalRR += t.risk > 0 ? (Math.abs(t.profit) / t.risk) : 0;
            
            // Asset Tracking
            instMap[t.symbol] = (instMap[t.symbol] || 0) + t.profit;

            // Session Tracking
            if(!sessionStats[t.session]) sessionStats[t.session] = { pnl: 0, w: 0, l: 0 };
            sessionStats[t.session].pnl += t.profit;
            if(t.profit >= 0) sessionStats[t.session].w++;
            else sessionStats[t.session].l++;

            body.innerHTML += `<tr><td>${t.date}</td><td>${t.symbol}</td><td>${t.lots}</td><td>${t.side}</td><td><span style="color:#888; font-size:0.75rem;">${t.session}</span></td><td style="color:${t.profit>=0?'var(--positive)':'var(--negative)'}">$${t.profit.toFixed(2)}</td><td>${t.duration}m</td><td><button onclick="ui.deleteTrade(${t.id})">Del</button></td></tr>`;
        });

        // Main Analytics Updates
        document.getElementById('s-pf').innerText = gLoss > 0 ? (gProf / gLoss).toFixed(2) : gProf.toFixed(2);
        document.getElementById('s-gp').innerText = `$${gProf.toFixed(0)}`;
        document.getElementById('s-gl').innerText = `-$${gLoss.toFixed(0)}`;
        document.getElementById('s-awl').innerText = `$${(winCount?gProf/winCount:0).toFixed(0)} / -$${(lossCount?gLoss/lossCount:0).toFixed(0)}`;
        document.getElementById('s-arr').innerText = `1:${(trades.length && totalRR ? totalRR/trades.length : 0).toFixed(1)}`;
        document.getElementById('s-adur').innerText = `${(trades.length ? totalDur/trades.length : 0).toFixed(0)}m`;
        
        // Asset & Session Calculations
        const bestAsset = Object.entries(instMap).sort((a,b) => b[1] - a[1])[0];
        document.getElementById('s-best-inst').innerText = bestAsset ? `${bestAsset[0]} (${bestAsset[1] >= 0 ? '+' : ''}$${bestAsset[1].toFixed(0)})` : "---";

        const validSessions = Object.entries(sessionStats).filter(s => s[1].w > 0 || s[1].l > 0);
        
        if (validSessions.length > 0) {
            // Sort to find best (highest P/L) and worst (lowest P/L)
            const sortedSessions = validSessions.sort((a, b) => b[1].pnl - a[1].pnl);
            const bestSess = sortedSessions[0];
            const worstSess = sortedSessions[sortedSessions.length - 1];

            document.getElementById('s-best-session').innerText = `${bestSess[0]} (+$${bestSess[1].pnl.toFixed(0)} | ${bestSess[1].w}W:${bestSess[1].l}L)`;
            
            // Format worst session negative sign cleanly
            const worstPrefix = worstSess[1].pnl < 0 ? '-' : '+';
            document.getElementById('s-worst-session').innerText = `${worstSess[0]} (${worstPrefix}$${Math.abs(worstSess[1].pnl).toFixed(0)} | ${worstSess[1].w}W:${worstSess[1].l}L)`;
        } else {
            document.getElementById('s-best-session').innerText = "---";
            document.getElementById('s-worst-session').innerText = "---";
        }

        this.updateCharts(cumulative, trades.map(t=>t.date), winCount, lossCount);
        this.renderCalendar();
    },

    renderCalendar() {
        const grid = document.getElementById('calendarGrid'); grid.innerHTML = '';
        const m = parseInt(document.getElementById('cal-month').value);
        const y = parseInt(document.getElementById('cal-year').value);
        const days = new Date(y, m + 1, 0).getDate();
        const trades = JournalStore.fetch();

        for (let i = 1; i <= days; i++) {
            const dStr = `${y}-${String(m+1).padStart(2,'0')}-${String(i).padStart(2,'0')}`;
            const dayTrades = trades.filter(t => t.date === dStr);
            const dayPL = dayTrades.reduce((s, t) => s + t.profit, 0);
            const status = dayTrades.length > 0 ? (dayPL >= 0 ? 'profit' : 'loss') : '';
            grid.innerHTML += `<div class="cal-day ${status}"><b>${i}</b>${dayTrades.length > 0 ? `<div style="font-size:0.8rem; margin-top: 10px; color:${dayPL>=0?'var(--positive)':'var(--negative)'}">$${dayPL.toFixed(0)}</div>` : ''}</div>`;
        }
    },

    updateCharts(eq, labels, wins, losses) {
        if(this.charts.equity) this.charts.equity.destroy();
        this.charts.equity = new Chart(document.getElementById('equityChart'), {
            type: 'line', 
            data: { 
                labels: labels.length ? labels : ['No Data'], 
                datasets: [{ 
                    label: 'Equity Curve', 
                    data: eq.length ? eq : [0], 
                    borderColor: '#ffffff', 
                    borderWidth: 2,
                    fill: true, 
                    backgroundColor: 'rgba(255,255,255,0.05)', 
                    tension: 0.1,
                    pointBackgroundColor: '#000',
                    pointBorderColor: '#fff'
                }] 
            },
            options: {
                scales: {
                    x: { grid: { color: '#222' } },
                    y: { grid: { color: '#222' } }
                }
            }
        });
        
        if(this.charts.pie) this.charts.pie.destroy();
        this.charts.pie = new Chart(document.getElementById('pieChart'), {
            type: 'doughnut', 
            data: { 
                labels: ['Wins', 'Losses'], 
                datasets: [{ 
                    data: (wins === 0 && losses === 0) ? [1, 0] : [wins, losses], 
                    backgroundColor: ['#44ff88', '#ff4444'], 
                    borderWidth: 2,
                    borderColor: '#0a0a0a'
                }] 
            },
            options: {
                cutout: '75%',
                plugins: {
                    legend: { position: 'bottom' }
                }
            }
        });
    },

    deleteTrade(id) { JournalStore.save(JournalStore.fetch().filter(t => t.id !== id)); this.renderAll(); }
};

window.onload = () => ui.init();
</script>
</body>
</html>