<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neon Ledger Pro // Auto-Calc Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Orbitron:wght@700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg: #05070a;
            --glass: rgba(15, 20, 30, 0.9);
            --glass-border: rgba(255, 255, 255, 0.1);
            --text-main: #e0e6ed;
            --primary: #00fff0;
            --negative: #ff3366;
            --positive: #00ff88;
        }

        .theme-pink { --primary: #ff00ff; }
        .theme-green { --primary: #39ff14; }

        body { background: var(--bg); color: var(--text-main); font-family: 'Inter', sans-serif; margin: 0; }
        .app-container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        
        header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--glass-border); padding-bottom: 20px; margin-bottom: 20px; }
        h1 { font-family: 'Orbitron'; color: var(--primary); font-size: 1.4rem; text-shadow: 0 0 10px var(--primary); }

        .card { background: var(--glass); border: 1px solid var(--glass-border); border-radius: 12px; padding: 20px; margin-bottom: 20px; }
        
        /* Form Styling */
        .trade-form { display: grid; grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); gap: 12px; }
        input, select, button { background: #000; border: 1px solid var(--glass-border); color: #fff; padding: 12px; border-radius: 6px; }
        
        .side-buy { color: var(--positive); border-color: var(--positive); }
        .side-sell { color: var(--negative); border-color: var(--negative); }

        .calc-preview { grid-column: 1 / -1; display: flex; gap: 20px; font-size: 0.8rem; color: var(--primary); padding: 5px; border-top: 1px dashed var(--glass-border); margin-top: 10px; }

        /* Table Styling */
        table { width: 100%; border-collapse: collapse; }
        th { font-family: 'Orbitron'; color: var(--primary); padding: 15px; border-bottom: 2px solid var(--primary); font-size: 0.7rem; }
        td { padding: 12px; border-bottom: 1px solid var(--glass-border); font-size: 0.85rem; text-align: center; }
        tbody tr:nth-child(even) { background: rgba(255,255,255,0.03); }

        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); }
        .modal-content { margin: auto; display: block; max-width: 80%; max-height: 80%; margin-top: 5vh; border: 2px solid var(--primary); }
    </style>
</head>
<body class="theme-blue">

<div class="app-container">
    <header>
        <h1>NEON_LEDGER // AUTO_CALC</h1>
        <div class="theme-switcher">
            <button onclick="ui.setTheme('blue')" style="background:#00fff0; width:15px; height:15px; border-radius:50%;"></button>
            <button onclick="ui.setTheme('pink')" style="background:#ff00ff; width:15px; height:15px; border-radius:50%;"></button>
        </div>
    </header>

    <div class="card">
        <h3>LOG EXECUTION</h3>
        <div class="trade-form">
            <select id="t-side" onchange="ui.updatePreviews()">
                <option value="BUY">BUY / LONG</option>
                <option value="SELL">SELL / SHORT</option>
            </select>
            <input type="text" id="t-symbol" placeholder="SYMBOL">
            <input type="number" id="t-lots" placeholder="LOTS" step="0.01" oninput="ui.updatePreviews()">
            <input type="number" id="t-entry" placeholder="ENTRY PRICE" step="any" oninput="ui.updatePreviews()">
            <input type="number" id="t-sl" placeholder="STOP LOSS" step="any" oninput="ui.updatePreviews()">
            <input type="number" id="t-tp" placeholder="TAKE PROFIT" step="any" oninput="ui.updatePreviews()">
            <input type="number" id="t-exit" placeholder="ACTUAL EXIT" step="any" oninput="ui.updatePreviews()">
            <input type="file" id="t-image" accept="image/*">
            <button onclick="ui.handleNewTrade()" style="background:var(--primary); color:#000; font-weight:bold; cursor:pointer;">SAVE TRADE</button>
            
            <div class="calc-preview">
                <span>Est. Risk ($): <b id="p-risk">0.00</b></span>
                <span>Est. Reward ($): <b id="p-reward">0.00</b></span>
                <span>Actual P/L ($): <b id="p-actual">0.00</b></span>
            </div>
        </div>
    </div>

    <div class="card">
        <canvas id="equityChart" height="100"></canvas>
    </div>

    <div class="card" style="overflow-x: auto;">
        <table>
            <thead>
                <tr>
                    <th>SIDE</th>
                    <th>SYMBOL</th>
                    <th>ENTRY</th>
                    <th>EXIT</th>
                    <th>RISK:REWARD</th>
                    <th>NET P/L ($)</th>
                    <th>SCREEN</th>
                    <th>ACTION</th>
                </tr>
            </thead>
            <tbody id="tradeBody"></tbody>
        </table>
    </div>
</div>

<div id="imageModal" class="modal" onclick="this.style.display='none'">
    <img class="modal-content" id="modalImg">
</div>

<script>
    const JournalStore = {
        key: 'neon_ledger_autocalc',
        fetch: () => JSON.parse(localStorage.getItem(JournalStore.key)) || [],
        save: (d) => localStorage.setItem(JournalStore.key, JSON.stringify(d))
    };

    const ui = {
        chart: null,
        contractSize: 100000, // Standard Lot Size (Adjust for Crypto/Forex)

        init() { this.renderAll(); },

        setTheme(t) { document.body.className = `theme-${t}`; this.renderAll(); },

        // THE AUTO-CALCULATION ENGINE
        calculate(side, entry, price, lots) {
            if (!entry || !price || !lots) return 0;
            const multiplier = side === 'BUY' ? 1 : -1;
            return (price - entry) * (lots * this.contractSize) * multiplier;
        },

        updatePreviews() {
            const side = document.getElementById('t-side').value;
            const entry = parseFloat(document.getElementById('t-entry').value);
            const sl = parseFloat(document.getElementById('t-sl').value);
            const tp = parseFloat(document.getElementById('t-tp').value);
            const exit = parseFloat(document.getElementById('t-exit').value);
            const lots = parseFloat(document.getElementById('t-lots').value);

            document.getElementById('p-risk').innerText = Math.abs(this.calculate(side, entry, sl, lots)).toFixed(2);
            document.getElementById('p-reward').innerText = Math.abs(this.calculate(side, entry, tp, lots)).toFixed(2);
            document.getElementById('p-actual').innerText = this.calculate(side, entry, exit, lots).toFixed(2);
            
            document.getElementById('t-side').className = side === 'BUY' ? 'side-buy' : 'side-sell';
        },

        async handleNewTrade() {
            const side = document.getElementById('t-side').value;
            const entry = parseFloat(document.getElementById('t-entry').value);
            const exit = parseFloat(document.getElementById('t-exit').value);
            const lots = parseFloat(document.getElementById('t-lots').value);
            const sl = parseFloat(document.getElementById('t-sl').value);
            
            const file = document.getElementById('t-image').files[0];
            let base64 = file ? await this.toBase64(file) : "";

            const trade = {
                id: Date.now(),
                date: new Date().toLocaleDateString(),
                side, symbol: document.getElementById('t-symbol').value.toUpperCase(),
                entry, exit, sl, lots,
                profit: this.calculate(side, entry, exit, lots),
                risk: Math.abs(this.calculate(side, entry, sl, lots)),
                screenshot: base64
            };

            const data = JournalStore.fetch();
            data.push(trade);
            JournalStore.save(data);
            this.renderAll();
        },

        renderAll() {
            const trades = JournalStore.fetch();
            const body = document.getElementById('tradeBody');
            body.innerHTML = '';
            let cumulative = [];
            let total = 0;

            trades.forEach(t => {
                total += t.profit;
                cumulative.push(total);
                const rr = t.risk > 0 ? (Math.abs(t.profit) / t.risk).toFixed(2) : "0.00";

                body.innerHTML += `
                    <tr>
                        <td class="${t.side === 'BUY' ? 'side-buy' : 'side-sell'}"><b>${t.side}</b></td>
                        <td>${t.symbol}</td>
                        <td>${t.entry}</td>
                        <td>${t.exit}</td>
                        <td>1:${rr}</td>
                        <td style="color:${t.profit >= 0 ? 'var(--positive)' : 'var(--negative)'}">
                            ${t.profit >= 0 ? '+' : ''}${t.profit.toFixed(2)}
                        </td>
                        <td>${t.screenshot ? `<button onclick="ui.viewImg('${t.screenshot}')">VIEW</button>` : '-'}</td>
                        <td><button onclick="ui.deleteTrade(${t.id})">DEL</button></td>
                    </tr>
                `;
            });
            this.updateChart(cumulative, trades.map(t => t.date));
        },

        updateChart(data, labels) {
            const ctx = document.getElementById('equityChart').getContext('2d');
            if(this.chart) this.chart.destroy();
            const color = getComputedStyle(document.documentElement).getPropertyValue('--primary');
            this.chart = new Chart(ctx, {
                type: 'line',
                data: { labels, datasets: [{ label: 'Equity', data, borderColor: color, fill: true, backgroundColor: color+'22' }] },
                options: { scales: { y: { ticks: { color: '#fff' } }, x: { ticks: { color: '#fff' } } } }
            });
        },

        toBase64: f => new Promise((res) => { const r = new FileReader(); r.readAsDataURL(f); r.onload = () => res(r.result); }),
        viewImg(s) { document.getElementById('modalImg').src = s; document.getElementById('imageModal').style.display = 'block'; },
        deleteTrade(id) { 
            const d = JournalStore.fetch().filter(t => t.id !== id); 
            JournalStore.save(d); 
            this.renderAll(); 
        }
    };

    window.onload = () => ui.init();
</script>
</body>
</html>