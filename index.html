<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neon Ledger Pro // Trading Journal</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Orbitron:wght@700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* CSS ARCHITECTURE: Variables & Themes */
        :root {
            --bg: #05070a;
            --glass: rgba(15, 20, 30, 0.85);
            --glass-border: rgba(255, 255, 255, 0.1);
            --text-main: #e0e6ed;
            --primary: #00fff0; /* Default Blue */
            --primary-glow: rgba(0, 255, 240, 0.3);
            --negative: #ff3366;
            --positive: #00ff88;
        }

        .theme-pink { --primary: #ff00ff; --primary-glow: rgba(255, 0, 255, 0.3); }
        .theme-green { --primary: #39ff14; --primary-glow: rgba(57, 255, 20, 0.3); }

        body {
            background: var(--bg);
            color: var(--text-main);
            font-family: 'Inter', sans-serif;
            margin: 0;
            line-height: 1.6;
            transition: all 0.3s ease;
        }

        .app-container { max-width: 1200px; margin: 0 auto; padding: 20px; }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-bottom: 1px solid var(--glass-border);
            margin-bottom: 30px;
        }

        h1 { font-family: 'Orbitron'; font-size: 1.5rem; letter-spacing: 2px; color: var(--primary); text-shadow: 0 0 10px var(--primary-glow); }

        /* Theme Buttons */
        .theme-switcher { display: flex; gap: 10px; }
        .btn-theme { width: 20px; height: 20px; border-radius: 50%; border: 2px solid #fff; cursor: pointer; }
        .blue { background: #00fff0; } .pink { background: #ff00ff; } .green { background: #39ff14; }

        /* Glass Cards */
        .card {
            background: var(--glass);
            backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.6);
        }

        /* Analytics Grid */
        .analytics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        h3 { font-family: 'Orbitron'; font-size: 0.9rem; color: var(--primary); margin-top: 0; }

        /* Form Styling */
        .trade-form { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 10px; }
        input, select, button {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--glass-border);
            color: #fff;
            padding: 10px;
            border-radius: 6px;
            font-family: 'Inter';
        }
        input:focus { border-color: var(--primary); outline: none; }
        .btn-primary { 
            background: transparent; border: 1px solid var(--primary); color: var(--primary); 
            cursor: pointer; font-family: 'Orbitron'; font-size: 0.8rem; transition: 0.3s;
        }
        .btn-primary:hover { background: var(--primary); color: #000; box-shadow: 0 0 15px var(--primary); }

        /* Table Styling with Zebra Stripes */
        .table-wrapper { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; text-align: left; }
        th { font-family: 'Orbitron'; color: var(--primary); padding: 15px; font-size: 0.75rem; border-bottom: 2px solid var(--primary); }
        td { padding: 12px 15px; border-bottom: 1px solid var(--glass-border); font-size: 0.9rem; }
        tbody tr:nth-child(even) { background: rgba(255, 255, 255, 0.03); }
        tbody tr:hover { background: rgba(255, 255, 255, 0.07); box-shadow: inset 3px 0 0 var(--primary); }

        /* Modal */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); }
        .modal-content { margin: auto; display: block; max-width: 85%; max-height: 85%; border: 2px solid var(--primary); margin-top: 5vh; }
        .close { position: absolute; top: 20px; right: 35px; color: #fff; font-size: 40px; cursor: pointer; }

        @media (max-width: 768px) { .trade-form { grid-template-columns: 1fr 1fr; } }
    </style>
</head>
<body class="theme-blue">

    <div class="app-container">
        <header>
            <h1>NEON_LEDGER // V2.0</h1>
            <div class="theme-switcher">
                <button onclick="ui.setTheme('blue')" class="btn-theme blue" title="Cyan Theme"></button>
                <button onclick="ui.setTheme('pink')" class="btn-theme pink" title="Neon Pink Theme"></button>
                <button onclick="ui.setTheme('green')" class="btn-theme green" title="Matrix Green Theme"></button>
            </div>
        </header>

        <section class="analytics-grid">
            <div class="card">
                <h3>EQUITY CURVE (CUMULATIVE P/L)</h3>
                <canvas id="equityChart"></canvas>
            </div>
            <div class="card">
                <h3>WIN RATE BY TAG</h3>
                <canvas id="tagChart"></canvas>
            </div>
        </section>

        <section class="card">
            <h3>LOG NEW EXECUTION</h3>
            <div class="trade-form">
                <input type="date" id="t-date">
                <input type="text" id="t-symbol" placeholder="SYMBOL">
                <input type="number" id="t-entry" placeholder="ENTRY" step="any">
                <input type="number" id="t-exit" placeholder="EXIT" step="any">
                <input type="number" id="t-stop" placeholder="STOP LOSS" step="any">
                <input type="number" id="t-lots" placeholder="LOTS" step="0.01">
                <select id="t-tag">
                    <option value="Trend">Trend Follow</option>
                    <option value="Breakout">Breakout</option>
                    <option value="Reversal">Reversal</option>
                    <option value="FOMO">FOMO</option>
                </select>
                <input type="file" id="t-image" accept="image/*">
                <button onclick="ui.handleNewTrade()" class="btn-primary">LOG TRADE</button>
            </div>
        </section>

        <section class="card table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>DATE</th>
                        <th>SYMBOL</th>
                        <th>R:R</th>
                        <th>NET P/L</th>
                        <th>TAG</th>
                        <th>SCREENSHOT</th>
                        <th>ACTION</th>
                    </tr>
                </thead>
                <tbody id="tradeBody"></tbody>
            </table>
        </section>
    </div>

    <div id="imageModal" class="modal">
        <span class="close" onclick="ui.closeModal()">&times;</span>
        <img class="modal-content" id="modalImg">
    </div>

    <script>
        /**
         * DATA ARCHITECTURE: LocalStorage Wrapper
         */
        const JournalStore = {
            key: 'neon_journal_v2',
            fetch: () => JSON.parse(localStorage.getItem(JournalStore.key)) || [],
            save: (data) => localStorage.setItem(JournalStore.key, JSON.stringify(data)),
            add: (trade) => { const d = JournalStore.fetch(); d.push(trade); JournalStore.save(d); },
            remove: (id) => { const d = JournalStore.fetch().filter(t => t.id !== id); JournalStore.save(d); }
        };

        /**
         * UI ENGINE: Logic and Rendering
         */
        const ui = {
            charts: {},

            init() {
                this.renderAll();
            },

            setTheme(name) {
                document.body.className = `theme-${name}`;
                this.renderCharts();
            },

            async handleNewTrade() {
                const imgFile = document.getElementById('t-image').files[0];
                let base64 = "";
                if (imgFile) base64 = await this.toBase64(imgFile);

                const trade = {
                    id: Date.now(),
                    date: document.getElementById('t-date').value || new Date().toISOString().split('T')[0],
                    symbol: document.getElementById('t-symbol').value.toUpperCase(),
                    entry: parseFloat(document.getElementById('t-entry').value) || 0,
                    exit: parseFloat(document.getElementById('t-exit').value) || 0,
                    stop: parseFloat(document.getElementById('t-stop').value) || 0,
                    lots: parseFloat(document.getElementById('t-lots').value) || 0,
                    tag: document.getElementById('t-tag').value,
                    screenshot: base64
                };

                JournalStore.add(trade);
                this.renderAll();
            },

            renderAll() {
                const trades = JournalStore.fetch();
                const container = document.getElementById('tradeBody');
                container.innerHTML = '';

                trades.forEach(t => {
                    const profit = (t.exit - t.entry) * (t.lots * 100);
                    const risk = Math.abs(t.entry - t.stop);
                    const reward = Math.abs(t.exit - t.entry);
                    const rr = risk > 0 ? (reward / risk).toFixed(2) : "0.00";

                    container.innerHTML += `
                        <tr>
                            <td>${t.date}</td>
                            <td><strong>${t.symbol}</strong></td>
                            <td>1:${rr}</td>
                            <td style="color: ${profit >= 0 ? 'var(--positive)' : 'var(--negative)'}">
                                ${profit >= 0 ? '+' : ''}$${profit.toFixed(2)}
                            </td>
                            <td><span style="font-size:0.7rem; border:1px solid var(--primary); padding:2px 5px; border-radius:4px;">${t.tag}</span></td>
                            <td>
                                ${t.screenshot ? `<button onclick="ui.openModal('${t.screenshot}')" style="font-size:0.6rem; padding:4px;">VIEW</button>` : 'NONE'}
                            </td>
                            <td><button onclick="ui.deleteTrade(${t.id})" style="border-color:var(--negative); color:var(--negative); font-size:0.6rem;">DEL</button></td>
                        </tr>
                    `;
                });
                this.renderCharts();
            },

            renderCharts() {
                const trades = JournalStore.fetch();
                const primaryColor = getComputedStyle(document.documentElement).getPropertyValue('--primary').trim();

                // Equity Curve Calculation
                let sum = 0;
                const equityData = trades.map(t => {
                    sum += (t.exit - t.entry) * (t.lots * 100);
                    return sum;
                });

                this.updateChart('equityChart', 'line', trades.map(t => t.date), equityData, primaryColor);

                // Win Rate by Tag Calculation
                const tags = {};
                trades.forEach(t => {
                    if (!tags[t.tag]) tags[t.tag] = { w: 0, t: 0 };
                    tags[t.tag].t++;
                    if (t.exit > t.entry) tags[t.tag].w++;
                });

                const tagLabels = Object.keys(tags);
                const tagValues = tagLabels.map(k => (tags[k].w / tags[k].total || tags[k].t) * 100);
                this.updateChart('tagChart', 'bar', tagLabels, tagValues, primaryColor);
            },

            updateChart(id, type, labels, data, color) {
                if (this.charts[id]) this.charts[id].destroy();
                const ctx = document.getElementById(id).getContext('2d');
                this.charts[id] = new Chart(ctx, {
                    type: type,
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Performance',
                            data: data,
                            borderColor: color,
                            backgroundColor: color + '22',
                            fill: true,
                            tension: 0.3
                        }]
                    },
                    options: { 
                        plugins: { legend: { display: false } },
                        scales: { 
                            y: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#fff' } },
                            x: { grid: { display: false }, ticks: { color: '#fff' } }
                        }
                    }
                });
            },

            toBase64: file => new Promise((res, rej) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => res(reader.result);
                reader.onerror = e => rej(e);
            }),

            deleteTrade(id) {
                JournalStore.remove(id);
                this.renderAll();
            },

            openModal(src) {
                document.getElementById('imageModal').style.display = "block";
                document.getElementById('modalImg').src = src;
            },

            closeModal() {
                document.getElementById('imageModal').style.display = "none";
            }
        };

        window.onload = () => ui.init();
    </script>
</body>
</html>